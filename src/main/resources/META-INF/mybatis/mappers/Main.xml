<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  -->
<mapper namespace="Main">

	<!-- <select id="mainSelect" resultType="String">
		SELECT emp_nm 
			FROM TB_TEST
		WHERE emp_no = '000001'
	</select> -->
	
	<select id = "login" parameterType="UserVO" resultType="int">
		SELECT COUNT(*) 
			FROM TB_USER
		WHERE USER_ID = #{user_id}
			AND USER_PW = #{user_pw}
	</select>
	
	<insert id = "UserInsert" parameterType="UserVO" >
		INSERT ALL
			INTO TB_USER 
				VALUES (
					user_seq.nextval,
					#{user_id},
					#{user_pw},
					SYSDATE,
					''
				)
			INTO TB_USER_INFO 
				VALUES (
					user_seq.nextval,
					#{user_nickname},
					#{user_addr1},
					#{user_addr2},
					#{user_addr3},
					#{user_tel1},
					#{user_tel2},
					#{user_tel3},
					#{user_btd}
				)
			INTO TB_USER_PW_OLD 
				VALUES (
					user_seq.nextval,
					#{user_pw},
					'',	/*과거 데이터 없음으로 초기값 빈칸*/
					'',	/*과거 데이터 없음으로 초기값 빈칸*/
					'',	/*과거 데이터 없음으로 초기값 빈칸*/
					''	/*과거 데이터 없음으로 초기값 빈칸*/
				)
		SELECT * FROM DUAL
	</insert>
	
	<update id="TokenUpdate" parameterType="UserVO">
		UPDATE TB_USER 
			SET user_token = #{user_token}
		WHERE user_id = #{user_id}
	</update>
	
	<update id="logout" parameterType="UserVO">
		UPDATE TB_USER 
			SET user_token = ''	/*로그아웃 하면 토큰값 초기화*/
		WHERE user_id = #{user_id}
	</update>
	
	<select id="tokenSelect" parameterType="UserVO" resultType="int">
		SELECT COUNT(*)
			FROM TB_USER
		WHERE USER_TOKEN = #{user_token}
	</select>
	
	<select id="pwSelect" parameterType="UserVO" resultType="map">
		SELECT 	user_seq,
		        user_pw_old1,
		        user_pw_old2,
		        user_pw_old3,
		        user_pw_old4,
		        user_pw_old5
		    FROM TB_USER_PW_OLD
		WHERE USER_SEQ = (select user_seq from tb_user where user_id = #{user_id})
	</select>
	
	<update id="pwChangeMain" parameterType="UserVO">
		update tb_user
		    set user_pw = #{user_pw}
		where user_id = #{user_id}
	</update>
	
	<update id="pwChangeOld" parameterType="UserVO">
		update tb_user_pw_old
		    set user_pw_old1 = #{user_pw_old1},
		        user_pw_old2 = #{user_pw_old2},
		        user_pw_old3 = #{user_pw_old3},
		        user_pw_old4 = #{user_pw_old4},
		        user_pw_old5 = #{user_pw_old5}
		where user_seq = #{user_seq}
	</update>
</mapper>